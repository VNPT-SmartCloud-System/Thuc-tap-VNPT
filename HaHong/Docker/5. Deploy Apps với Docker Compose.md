# Deploy Apps với Docker Compose

#### Docker compose để triển khai và quản lý các multi-container application 

Thay vì gán mỗi microservice cùng với các tập lệnh docker, Docker Compose cho phép bạn mô tả toàn bộ ứng dụng trong một tệp cấu hình khai báo duy nhất và triển khai nó bằng một lệnh.
Khi app được triển khai, bạn có thể quản lý toàn bộ vòng đời với một tập lệnh đơn giản. Bạn thậm chí có thể lưu trữ và quản lý tệp cấu hình trong hệ thống điều khiển.
## Deploy apps with Compose
docker Compose là một công cụ mạnh mẽ, dùng để quản lý các ứng dụng nhiều comtainer của Docker. Với compose bạn sử dụng file YAML để config các multi-container cho application của bạn.
Installing Compose (Linux)
![](image1/installcompose.png)
### Compose file
Compose sử dụng các tệp YAML để định nghĩa các ứng dụng multi-service. Tên mặc định cho một tệp yaml là docker-compose.yml, tuy nhiên bạn có thể sử dụng cờ -f để chỉ định tên tệp tùy chỉnh
Ví dụ 
```sh
version: '2'

services:
   db:
     image: mysql:5.7
     volumes:
       - ./data:/var/lib/mysql
     restart: always
     environment:
       MYSQL_ROOT_PASSWORD: wordpress
       MYSQL_DATABASE: wordpress
       MYSQL_USER: wordpress
       MYSQL_PASSWORD: wordpress

   wordpress:
     depends_on:
       - db
     image: wordpress:latest
     ports:
       - "8000:80"
     restart: always
     environment:
       WORDPRESS_DB_HOST: db:3306
       WORDPRESS_DB_PASSWORD: wordpress
```
Compose file sẽ có 4 top-level keys:
- version: Chỉ ra phiên bản docker-compose sẽ sử dụng
- services: Trong mục sercices, chỉ ra những services (containers) mà ta sẽ cài đặt
      - image:  chỉ ra image sẽ được sử dụng để create containers.Ngoài ra, bạn có thể viết dockerfile và khai báo lệnh `build` để containers sẽ được create từ dockerfile.
      - restart: always: Tự động khởi chạy khi container bị shutdown.
      - environment: Khai báo các biến môi trường cho container. Cụ thể là thông tin cơ sở dữ liệu.
      - depends_on: db: Chỉ ra sự phụ thuộc của services wordpress với services db. Tức là services db phải chạy và tạo ra trước, thì services wordpress mới chạy
      - ports: Forwards the exposed port 80 của container sang port 8000 trên host machine.
- networks: Mặc định Compose sẽ tạo bridge network. các mạng đơn lẻ chỉ có thể kết nối các container trên cùng một Docker host.
Có thể sử dụng đoạn code sau đây trong tệp soạn thảo Docker file để tạo một overlay network cho phéo các thùng chứa đọc lập kết nối với nó
```sh
networks:
over-net:
driver: overlay
attachable: true
```
- volumes: mount counter-vol đến với thư mục trong docker
